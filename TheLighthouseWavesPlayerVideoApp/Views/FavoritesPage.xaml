<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TheLighthouseWavesPlayerVideoApp.Views.FavoritesPage"
             xmlns:viewmodels="clr-namespace:TheLighthouseWavesPlayerVideoApp.ViewModels"
             xmlns:models="clr-namespace:TheLighthouseWavesPlayerVideoApp.Models"
             x:DataType="viewmodels:FavoritesViewModel"
             Title="Favorites">

    <RefreshView Command="{Binding LoadFavoritesCommand}"
                 IsRefreshing="{Binding IsLoading}">
        <CollectionView ItemsSource="{Binding FavoriteVideos}"
                        SelectionMode="None"
                        EmptyView="No favorite videos found.">

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Video">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Remove"
                                           BackgroundColor="{StaticResource Error}"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FavoritesViewModel}}, Path=RemoveFromFavoritesCommand}"
                                           CommandParameter="{Binding .}" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <Frame Style="{StaticResource VideoItemFrame}" Margin="16,6">
                            <Grid Padding="12" ColumnDefinitions="Auto,*,Auto,Auto,Auto">
                                <Border Grid.Column="0"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 8,8,8,8"
                                        HeightRequest="70"
                                        WidthRequest="90"
                                        Shadow="{x:Null}">
                                    <Image Source="video_placeholder.png"
                                           Aspect="AspectFill"
                                           HeightRequest="70"
                                           WidthRequest="90" />
                                </Border>

                                <VerticalStackLayout Grid.Column="1"
                                                     Padding="14,0"
                                                     VerticalOptions="Center"
                                                     Spacing="3">
                                    <Label Text="{Binding Title}"
                                           FontAttributes="Bold"
                                           MaxLines="1"
                                           LineBreakMode="TailTruncation" />

                                    <Label Text="{Binding DateAdded, StringFormat='{0:MMM dd, yyyy}'}"
                                           TextColor="{AppThemeBinding Light={StaticResource TextSecondary}, Dark={StaticResource TextSecondaryDark}}"
                                           FontSize="12" />

                                    <Label Text="{Binding Duration, StringFormat='{0:hh\\:mm\\:ss}'}"
                                           TextColor="{AppThemeBinding Light={StaticResource TextSecondary}, Dark={StaticResource TextSecondaryDark}}"
                                           FontSize="12" />
                                </VerticalStackLayout>

                                <!-- Delete button -->
                                <Button Grid.Column="2"
                                        Text="🗑️"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FavoritesViewModel}}, Path=RemoveFromFavoritesCommand}"
                                        CommandParameter="{Binding .}"
                                        Style="{StaticResource VideoControlButton}"
                                        BackgroundColor="{StaticResource Error}"
                                        HeightRequest="40"
                                        WidthRequest="40"
                                        Margin="0,0,8,0" />
                                
                                <!-- Play button -->
                                <Button Grid.Column="3"
                                        Text="▶"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FavoritesViewModel}}, Path=PlayVideoCommand}"
                                        CommandParameter="{Binding .}"
                                        Style="{StaticResource VideoControlButton}"
                                        HeightRequest="40"
                                        WidthRequest="40"
                                        Margin="0,0,4,0" />
                            </Grid>
                        </Frame>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </RefreshView>
</ContentPage>